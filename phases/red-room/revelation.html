<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Revelation - Deep Web Mining Collective</title>

    <!-- CSS -->
    <link rel="stylesheet" href="../../assets/css/deep-web.css">
    <link rel="stylesheet" href="../../assets/css/glitch.css">
    <link rel="stylesheet" href="../../assets/css/terminal.css">

    <!-- Audio Elements -->
    <audio id="success-sound" preload="auto">
        <source src="../../assets/sounds/access-granted.mp3" type="audio/mpeg">
    </audio>

    <style>
        body {
            background: linear-gradient(45deg, #000011, #000000);
            overflow-x: hidden;
            animation: reality-shift 10s infinite;
        }

        @keyframes reality-shift {
            0%, 100% { background: linear-gradient(45deg, #000011, #000000); }
            25% { background: linear-gradient(45deg, #001100, #000000); }
            50% { background: linear-gradient(45deg, #110000, #000000); }
            75% { background: linear-gradient(45deg, #111100, #000000); }
        }

        .revelation-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        .revelation-header {
            text-align: center;
            margin-bottom: 50px;
            z-index: 10;
        }

        .revelation-title {
            font-size: 4em;
            color: #ffffff;
            margin: 0;
            text-shadow:
                0 0 10px #ffffff,
                0 0 20px #00ffff,
                0 0 30px #ff00ff;
            animation: title-shift 3s infinite;
            text-transform: uppercase;
            letter-spacing: 8px;
        }

        @keyframes title-shift {
            0%, 100% {
                text-shadow: 0 0 10px #ffffff, 0 0 20px #00ffff, 0 0 30px #ff00ff;
                transform: scale(1);
            }
            33% {
                text-shadow: 0 0 15px #ff0000, 0 0 25px #ffff00, 0 0 35px #00ff00;
                transform: scale(1.02);
            }
            66% {
                text-shadow: 0 0 12px #00ff00, 0 0 22px #ff00ff, 0 0 32px #ffff00;
                transform: scale(0.98);
            }
        }

        .revelation-content {
            max-width: 800px;
            background: rgba(0, 0, 0, 0.8);
            border: 3px solid #ffffff;
            padding: 40px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .revelation-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: revelation-scan 4s infinite;
        }

        @keyframes revelation-scan {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .truth-section {
            margin: 30px 0;
            padding: 25px;
            border-left: 5px solid #00ffff;
            background: rgba(0, 255, 255, 0.05);
            position: relative;
        }

        .truth-section h2 {
            color: #00ffff;
            margin-top: 0;
            font-size: 1.8em;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .truth-text {
            color: #ffffff;
            font-size: 1.1em;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .collective-manifest {
            background: linear-gradient(45deg, #001122, #000011);
            border: 3px solid #0088ff;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
            position: relative;
        }

        .manifest-title {
            color: #0088ff;
            font-size: 2.2em;
            margin-bottom: 20px;
            text-shadow: 0 0 15px #0088ff;
        }

        .manifest-text {
            color: #ffffff;
            font-size: 1.2em;
            line-height: 2;
            font-style: italic;
        }

        .coordinates-revelation {
            background: #000000;
            border: 3px solid #ffff00;
            padding: 25px;
            margin: 30px 0;
            font-family: 'Courier New', monospace;
        }

        .coordinates-title {
            color: #ffff00;
            text-align: center;
            font-size: 1.5em;
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        .coordinate-line {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px;
            background: rgba(255, 255, 0, 0.1);
        }

        .coord-label {
            color: #ffff00;
        }

        .coord-value {
            color: #ffffff;
            font-weight: bold;
        }

        .final-choice {
            background: linear-gradient(45deg, #220000, #110000);
            border: 4px solid #ff0000;
            padding: 40px;
            margin: 40px 0;
            text-align: center;
        }

        .choice-title {
            color: #ff0000;
            font-size: 2.5em;
            margin-bottom: 25px;
            text-shadow: 0 0 20px #ff0000;
            text-transform: uppercase;
        }

        .choice-text {
            color: #ffffff;
            font-size: 1.2em;
            line-height: 1.8;
            margin-bottom: 30px;
        }

        .choice-buttons {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .choice-btn {
            background: transparent;
            border: 3px solid;
            color: inherit;
            padding: 20px 40px;
            font-size: 1.2em;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .choice-btn.accept {
            border-color: #00ff00;
            color: #00ff00;
        }

        .choice-btn.accept:hover {
            background: #00ff00;
            color: #000000;
            box-shadow: 0 0 30px #00ff00;
        }

        .choice-btn.decline {
            border-color: #ff0000;
            color: #ff0000;
        }

        .choice-btn.decline:hover {
            background: #ff0000;
            color: #ffffff;
            box-shadow: 0 0 30px #ff0000;
        }

        .choice-btn.investigate {
            border-color: #ffff00;
            color: #ffff00;
        }

        .choice-btn.investigate:hover {
            background: #ffff00;
            color: #000000;
            box-shadow: 0 0 30px #ffff00;
        }

        .ending-section {
            display: none;
            background: rgba(0, 0, 0, 0.9);
            border: 4px solid;
            padding: 40px;
            margin: 40px 0;
            text-align: center;
            animation: ending-reveal 2s ease-in-out;
        }

        .ending-section.active {
            display: block;
        }

        @keyframes ending-reveal {
            0% { opacity: 0; transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }

        .ending-accept {
            border-color: #00ff00;
            color: #00ff00;
        }

        .ending-decline {
            border-color: #ff0000;
            color: #ff0000;
        }

        .ending-investigate {
            border-color: #ffff00;
            color: #ffff00;
        }

        .certificate {
            background: linear-gradient(45deg, #001100, #003300);
            border: 5px solid #00ff00;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        .certificate-title {
            color: #00ff00;
            font-size: 2em;
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        .certificate-text {
            color: #ffffff;
            line-height: 1.6;
        }

        .operative-id {
            color: #00ff00;
            font-size: 1.3em;
            font-weight: bold;
            margin: 15px 0;
            padding: 10px;
            border: 2px solid #00ff00;
        }

        .matrix-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.1;
        }

        .stats-summary {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ffffff;
            padding: 25px;
            margin: 30px 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            border: 1px solid #333333;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #00ffff;
        }

        .stat-label {
            color: #cccccc;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            .revelation-title {
                font-size: 2.5em;
                letter-spacing: 3px;
            }

            .choice-buttons {
                flex-direction: column;
                align-items: center;
            }

            .choice-btn {
                width: 80%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- Matrix Background -->
    <div class="matrix-background" id="matrix-bg"></div>

    <div class="revelation-container">
        <!-- Header -->
        <div class="revelation-header">
            <h1 class="revelation-title glitch-text" data-text="THE REVELATION">
                THE REVELATION
            </h1>
        </div>

        <!-- Main Content -->
        <div class="revelation-content">
            <div class="truth-section">
                <h2>The Truth About The Deep Web Mining Collective</h2>
                <div class="truth-text">
                    You have successfully completed the initiation process, and now the truth can be revealed.
                    The Deep Web Mining Collective is not what it appears to be. We are not criminals, hackers, or
                    a shadowy organization operating in the depths of the internet.
                </div>
                <div class="truth-text">
                    We are researchers, scientists, and explorers working on the cutting edge of dimensional reality.
                    The "mining operations" you discovered are actually sophisticated experiments in quantum consciousness
                    transfer and parallel universe data extraction.
                </div>
            </div>

            <div class="collective-manifest">
                <h2 class="manifest-title">Our Mission</h2>
                <div class="manifest-text">
                    "To explore the infinite possibilities of existence across multiple realities,
                    gathering knowledge and experiences that transcend the limitations of a single dimensional plane.
                    Every 'missing person' is actually a volunteer who has chosen to expand their consciousness
                    beyond the confines of traditional reality."
                </div>
            </div>

            <div class="coordinates-revelation">
                <div class="coordinates-title">Coordinate Convergence Analysis</div>
                <div class="coordinate-line">
                    <span class="coord-label">Surface Entry Point:</span>
                    <span class="coord-value">0, 64, 0</span>
                </div>
                <div class="coordinate-line">
                    <span class="coord-label">Terminal Access Hub:</span>
                    <span class="coord-value">-247, 45, 892</span>
                </div>
                <div class="coordinate-line">
                    <span class="coord-label">Network Node Alpha:</span>
                    <span class="coord-value">156, 78, -334</span>
                </div>
                <div class="coordinate-line">
                    <span class="coord-label">Network Node Beta:</span>
                    <span class="coord-value">-89, 82, 445</span>
                </div>
                <div class="coordinate-line">
                    <span class="coord-label">Network Node Gamma:</span>
                    <span class="coord-value">334, 91, -178</span>
                </div>
                <div class="coordinate-line">
                    <span class="coord-label">Final Convergence Point:</span>
                    <span class="coord-value">0, 100, 0</span>
                </div>
                <div style="margin-top: 20px; color: #ffffff; text-align: center;">
                    All coordinates lead to dimensional nexus points where reality barriers are thinnest.
                </div>
            </div>

            <div class="truth-section">
                <h2>Your Role in the Collective</h2>
                <div class="truth-text">
                    Your journey through our systems was not random. You were selected because of your curiosity,
                    problem-solving abilities, and willingness to question reality. Every puzzle you solved,
                    every system you "hacked," was actually a test of your compatibility with our dimensional
                    exploration protocols.
                </div>
                <div class="truth-text">
                    The other "missing persons" - Sarah Martinez, Marcus Chen, Elena Volkov, and others -
                    they all chose to join us. They discovered what you've now discovered: that there are
                    infinite realities beyond this one, each containing knowledge, experiences, and possibilities
                    that make our single existence seem infinitely small.
                </div>
            </div>
        </div>

        <!-- Player Statistics -->
        <div class="stats-summary" id="stats-summary">
            <!-- Stats will be populated by JavaScript -->
        </div>

        <!-- Final Choice -->
        <div class="final-choice">
            <h2 class="choice-title">Your Choice</h2>
            <div class="choice-text">
                Now that you know the truth, you have three options. This choice will determine your fate
                and your relationship with the Deep Web Mining Collective. Choose carefully - this decision
                cannot be undone.
            </div>

            <div class="choice-buttons">
                <button class="choice-btn accept" onclick="makeChoice('accept')">
                    Join the Collective
                </button>
                <button class="choice-btn decline" onclick="makeChoice('decline')">
                    Return to Reality
                </button>
                <button class="choice-btn investigate" onclick="makeChoice('investigate')">
                    Investigate Further
                </button>
            </div>
        </div>

        <!-- Ending Sections -->
        <div class="ending-section ending-accept" id="ending-accept">
            <h2 style="color: #00ff00; margin-top: 0;">Welcome to the Collective</h2>
            <p style="color: #ffffff; font-size: 1.2em; line-height: 1.8;">
                You have chosen to transcend the limitations of single-reality existence.
                Your consciousness will be expanded across multiple dimensional planes,
                allowing you to experience infinite possibilities and gather knowledge
                beyond human comprehension.
            </p>

            <div class="certificate">
                <div class="certificate-title">Deep Web Mining Operative Certificate</div>
                <div class="certificate-text">
                    This certifies that <strong><span id="operative-name">OPERATIVE_UNKNOWN</span></strong>
                    has successfully completed the Deep Web Mining Collective initiation process
                    and is hereby granted Level ∞ clearance for interdimensional operations.
                </div>
                <div class="operative-id" id="operative-id">
                    OPERATIVE ID: DWMC-∞-<span id="cert-timestamp"></span>
                </div>
                <div class="certificate-text">
                    Authorization granted for consciousness transfer protocols,
                    parallel reality exploration, and quantum data mining operations.
                </div>
            </div>

            <p style="color: #00ff00;">
                <strong>Your new reality begins now. Welcome to infinity.</strong>
            </p>
        </div>

        <div class="ending-section ending-decline" id="ending-decline">
            <h2 style="color: #ff0000; margin-top: 0;">Memory Wipe Initiated</h2>
            <p style="color: #ffffff; font-size: 1.2em; line-height: 1.8;">
                You have chosen to return to your previous reality. All memories of this experience
                will be erased, and you will return to your normal life with no recollection of
                the Deep Web Mining Collective or the truth you discovered.
            </p>
            <p style="color: #ffff00;">
                The world will seem exactly as it was before. You will never know what you chose to forget.
            </p>
            <p style="color: #ff0000;">
                <strong>Memory wipe in progress... 10... 9... 8... 7... 6... 5... 4... 3... 2... 1...</strong>
            </p>
            <p style="color: #ffffff;">
                <em>You wake up at your computer. You're not sure how long you've been staring at the screen.
                You close the browser and go back to your normal day, with a strange feeling that you've
                forgotten something important...</em>
            </p>
        </div>

        <div class="ending-section ending-investigate" id="ending-investigate">
            <h2 style="color: #ffff00; margin-top: 0;">The Investigator's Path</h2>
            <p style="color: #ffffff; font-size: 1.2em; line-height: 1.8;">
                You have chosen the path of the investigator. You will be granted limited access to our
                dimensional research, allowing you to study our methods and gradually understand the full
                scope of our operations.
            </p>
            <p style="color: #00ffff;">
                As an investigator, you serve as a bridge between realities - understanding both worlds
                but fully belonging to neither. You will help us identify new candidates and guide them
                through their own discovery process.
            </p>
            <div style="background: rgba(255, 255, 0, 0.1); padding: 20px; margin: 20px 0; border: 2px solid #ffff00;">
                <strong style="color: #ffff00;">INVESTIGATOR CLEARANCE GRANTED</strong><br>
                <span style="color: #ffffff;">
                    You now have access to our recruitment protocols and candidate evaluation systems.
                    Your mission: Find others like yourself and guide them to their own revelation.
                </span>
            </div>
            <p style="color: #ffff00;">
                <strong>Your investigation begins now. The truth awaits those who seek it.</strong>
            </p>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="../../assets/js/progress-tracker.js"></script>
    <script src="../../assets/js/glitch-effects.js"></script>

    <script>
        // Revelation Controller
        class RevelationController {
            constructor() {
                this.playerStats = this.calculatePlayerStats();
                this.choiceMade = false;

                this.initializeRevelation();
                this.createMatrixBackground();
                this.displayPlayerStats();
                this.triggerFinalEffects();
            }

            initializeRevelation() {
                // Mark revelation as accessed
                if (window.progressTracker) {
                    window.progressTracker.updateProgress('final', {
                        revelation_accessed: true,
                        revelation_time: Date.now()
                    });
                }

                // Generate operative ID
                const timestamp = Date.now().toString().slice(-8);
                document.getElementById('cert-timestamp').textContent = timestamp;

                // Set operative name (could be customized)
                document.getElementById('operative-name').textContent = 'OPERATIVE_' + timestamp.slice(-4);

                this.playSuccessSound();
            }

            calculatePlayerStats() {
                const progress = JSON.parse(localStorage.getItem('dwmc_progress') || '{}');
                const surfaceClues = JSON.parse(localStorage.getItem('surface_clues') || '[]');
                const breachSteps = JSON.parse(localStorage.getItem('breach_steps') || '[]');
                const ircKeys = JSON.parse(localStorage.getItem('irc_keys') || '[]');
                const accessedProfiles = JSON.parse(localStorage.getItem('accessed_profiles') || '[]');

                const startTime = progress.surface?.access_time || Date.now();
                const endTime = Date.now();
                const totalTime = Math.floor((endTime - startTime) / 1000 / 60); // minutes

                return {
                    totalTime: totalTime,
                    surfaceClues: surfaceClues.length,
                    breachSteps: breachSteps.length,
                    ircKeys: ircKeys.length,
                    profilesAccessed: accessedProfiles.length,
                    completionRate: this.calculateCompletionRate(progress)
                };
            }

            calculateCompletionRate(progress) {
                let completed = 0;
                const phases = ['surface', 'breach', 'deep', 'final'];

                phases.forEach(phase => {
                    if (progress[phase]?.completed) completed++;
                });

                return Math.floor((completed / phases.length) * 100);
            }

            displayPlayerStats() {
                const statsContainer = document.getElementById('stats-summary');

                const stats = [
                    { value: this.playerStats.totalTime, label: 'Minutes Played' },
                    { value: this.playerStats.surfaceClues, label: 'Surface Clues Found' },
                    { value: this.playerStats.breachSteps, label: 'Breach Steps Completed' },
                    { value: this.playerStats.ircKeys, label: 'IRC Keys Discovered' },
                    { value: this.playerStats.profilesAccessed, label: 'Profiles Accessed' },
                    { value: this.playerStats.completionRate + '%', label: 'Completion Rate' }
                ];

                stats.forEach(stat => {
                    const statElement = document.createElement('div');
                    statElement.className = 'stat-item';
                    statElement.innerHTML = `
                        <div class="stat-value">${stat.value}</div>
                        <div class="stat-label">${stat.label}</div>
                    `;
                    statsContainer.appendChild(statElement);
                });
            }

            createMatrixBackground() {
                const matrix = document.getElementById('matrix-bg');
                const chars = '01アイウエオカキクケコサシスセソタチツテトナニヌネノハヒフヘホマミムメモヤユヨラリルレロワヲン';

                for (let i = 0; i < 20; i++) {
                    const column = document.createElement('div');
                    column.style.position = 'absolute';
                    column.style.left = (i * 5) + '%';
                    column.style.top = '-100px';
                    column.style.color = '#00ff00';
                    column.style.fontSize = '14px';
                    column.style.fontFamily = 'Courier New, monospace';
                    column.style.animation = `matrix-fall ${3 + Math.random() * 3}s linear infinite`;
                    column.style.animationDelay = Math.random() * 2 + 's';

                    let text = '';
                    for (let j = 0; j < 30; j++) {
                        text += chars[Math.floor(Math.random() * chars.length)] + '<br>';
                    }
                    column.innerHTML = text;

                    matrix.appendChild(column);
                }

                // Add CSS animation
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes matrix-fall {
                        0% { top: -100px; opacity: 1; }
                        90% { opacity: 1; }
                        100% { top: 100vh; opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }

            triggerFinalEffects() {
                // Intense glitch effects for revelation
                if (window.glitchEffects) {
                    setTimeout(() => {
                        window.glitchEffects.intensifyGlitches();
                    }, 2000);
                }

                // Random reality shifts
                setInterval(() => {
                    if (Math.random() < 0.1) {
                        document.body.style.filter = `hue-rotate(${Math.random() * 360}deg) saturate(${0.5 + Math.random()}`;
                        setTimeout(() => {
                            document.body.style.filter = '';
                        }, 200);
                    }
                }, 3000);
            }

            playSuccessSound() {
                const audio = document.getElementById('success-sound');
                if (audio) {
                    audio.currentTime = 0;
                    audio.volume = 0.6;
                    audio.play().catch(() => {});
                }
            }
        }

        // Global choice function
        function makeChoice(choice) {
            if (window.revelationController.choiceMade) return;
            window.revelationController.choiceMade = true;

            // Hide choice section
            document.querySelector('.final-choice').style.display = 'none';

            // Show appropriate ending
            document.getElementById(`ending-${choice}`).classList.add('active');

            // Update progress tracker with final choice
            if (window.progressTracker) {
                window.progressTracker.updateProgress('final', {
                    final_choice: choice,
                    arg_completed: true,
                    completion_timestamp: Date.now()
                });
            }

            // Trigger choice-specific effects
            switch (choice) {
                case 'accept':
                    triggerAcceptEffects();
                    break;
                case 'decline':
                    triggerDeclineEffects();
                    break;
                case 'investigate':
                    triggerInvestigateEffects();
                    break;
            }
        }

        function triggerAcceptEffects() {
            // Green matrix effect
            document.body.style.background = 'linear-gradient(45deg, #001100, #000000)';

            if (window.glitchEffects) {
                window.glitchEffects.showSystemAlert(
                    'CONSCIOUSNESS TRANSFER INITIATED\n\nWelcome to the infinite collective, operative.\nYour journey beyond reality begins now.',
                    'success'
                );
            }
        }

        function triggerDeclineEffects() {
            // Red warning effects
            document.body.style.background = 'linear-gradient(45deg, #110000, #000000)';

            // Gradual fade to black
            setTimeout(() => {
                document.body.style.transition = 'all 10s ease';
                document.body.style.opacity = '0';
                setTimeout(() => {
                    document.body.style.background = '#000000';
                    document.body.style.opacity = '1';
                    document.body.innerHTML = '<div style="color: #ffffff; text-align: center; padding: 50px; font-family: Arial;">You are now browsing the internet normally. Nothing unusual happened.</div>';
                }, 10000);
            }, 5000);
        }

        function triggerInvestigateEffects() {
            // Yellow investigator theme
            document.body.style.background = 'linear-gradient(45deg, #111100, #000000)';

            if (window.glitchEffects) {
                window.glitchEffects.showSystemAlert(
                    'INVESTIGATOR STATUS GRANTED\n\nAccess to recruitment protocols activated.\nYour mission to find new candidates begins.',
                    'info'
                );
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            window.revelationController = new RevelationController();
        });
    </script>
</body>
</html>